name: build
permissions: read-all
on:
  push:
    branches:
      - master
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        pg-version: [13, 14, 15, 16, 17]
    steps:
      - id: checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: false
      - uses: ankane/setup-postgres@v1
        with:
          postgres-version: ${{ matrix.pg-version }}
          dev-files: true
      - run: make
        env:
          PG_CFLAGS: -DUSE_ASSERT_CHECKING -Wall -Wextra -Werror -Wno-unused-parameter -Wno-sign-compare
      - run: |
          export PG_CONFIG=`which pg_config`
          sudo --preserve-env=PG_CONFIG make install
